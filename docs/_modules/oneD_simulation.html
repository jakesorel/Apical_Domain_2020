

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>oneD_simulation &mdash; Apical Domain 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Apical Domain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../oneDsim_sim.html">Simulation class for regular equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oneDsim_ps.html">Phase space class for regular equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nd_sim.html">Simulation class for dimensionless equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nd_ps.html">Phase space class for dimensionless equations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apical Domain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>oneD_simulation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for oneD_simulation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;pdf.fonttype&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>


<div class="viewcode-block" id="simulation"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation">[docs]</a><span class="k">class</span> <span class="nc">simulation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulator object for regular equations.</span>

<span class="sd">    Uses finite-difference method of solving PDE defined in Supplementary Modelling</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="simulation.__init__"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D_E</span> <span class="o">=</span> <span class="mf">0.100673828125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_off</span> <span class="o">=</span> <span class="mf">0.01755789881449827</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_on</span> <span class="o">=</span> <span class="mf">1.88</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_crit</span> <span class="o">=</span> <span class="mf">6.89334310e+01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PIP2_tot</span> <span class="o">=</span> <span class="mf">2.67800940e+03</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_apical</span> <span class="o">=</span> <span class="mf">37.0492</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tfin</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_span</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysolorig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysolshift</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysol_apical</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">make_directory</span><span class="p">(</span><span class="s2">&quot;plots&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pol_thresh</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apical_mask</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_heights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[]</span></div>




<div class="viewcode-block" id="simulation.make_directory"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.make_directory">[docs]</a>    <span class="k">def</span> <span class="nf">make_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a new directory, specified by the string dir</span>
<span class="sd">        :param dir: Directory name (**string**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="simulation.set_num_x"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.set_num_x">[docs]</a>    <span class="k">def</span> <span class="nf">set_num_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">apical_on</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets spatial discretisation of number **num_x**</span>

<span class="sd">        if **apical_on** is **True**, then **n** specifies the number of spatial blocks within the apical domain</span>
<span class="sd">        (of length **self.l_apical**), and **self.num_x** is computed with respect to the ratio of **self.l_apical** and</span>
<span class="sd">        **self.L** (the full domain length i.e. cell perimeter)</span>

<span class="sd">        if **apical_on** is **False**, then **n** defines **self.num_x**</span>
<span class="sd">        :param n: Number of spatial blocks (**np.int32**)</span>
<span class="sd">        :param apical_on: Specifies whether apical membrane is considered specifically or not (**np.bool**)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apical_on</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span> <span class="o">=</span> <span class="n">n</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_apical</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apical_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apical_mask</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_x</span></div>

<div class="viewcode-block" id="simulation.set_t_span"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.set_t_span">[docs]</a>    <span class="k">def</span> <span class="nf">set_t_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">tfin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets temporal discretisation. Saves a 1D array of time-points to **self.t_span**</span>

<span class="sd">        :param dt: Time-step (**np.float32**)</span>
<span class="sd">        :param tfin: Final time-step (**np.float32**)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfin</span> <span class="o">=</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tfin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tfin</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span></div>


<div class="viewcode-block" id="simulation.set_initial"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.set_initial">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mean</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">SD</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">apical_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial conditions of **E**.</span>

<span class="sd">        If **override** is **False**, then the initial condition of **E**, **self.y0**, is given by a normal distribution,</span>
<span class="sd">        with mean **mean** and standard deviation **SD**</span>

<span class="sd">        If **overide** is not **False** but instead a 1D array of length (**self.num_x**), then **self.y0** is defined as</span>
<span class="sd">        **override**</span>

<span class="sd">        If **apical_on** is **True**, then outside the apical membrane, **self.y0** is set to 1e-17 (&lt;&lt;1)</span>

<span class="sd">        :param mean: Mean value used in normal distribution (**np.float32**)</span>
<span class="sd">        :param SD: Standard deviation used in normal distribution (**np.float32**)</span>
<span class="sd">        :param override: Override 1D array if provided (**np.ndarray** of dtype **np.float32**), else **False**</span>
<span class="sd">        :param apical_on: Sets **self.y0** to (approx.) 0 outside the apical membrane.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">override</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="n">SD</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">override</span>
        <span class="k">if</span> <span class="n">apical_on</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">apical_mask</span> <span class="o">+</span> <span class="mf">1e-17</span></div>

<div class="viewcode-block" id="simulation.del_1d"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.del_1d">[docs]</a>    <span class="k">def</span> <span class="nf">del_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Central difference discretisation of the Laplacian.</span>
<span class="sd">        :param y: Spatially discretised 1D function (i.e. a **np.ndarray** of dtype **np.float32**) on which the function is applied</span>
<span class="sd">        :param dx: Spatial discretisation lengthscale (**np.float32**)</span>
<span class="sd">        :return: Spatially discretised Laplacian of y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span></div>

<div class="viewcode-block" id="simulation.f"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.f">[docs]</a>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        System of partial differential equations as defined in the Supplementary Modelling, describing the spatio-temporal</span>
<span class="sd">        evolution of **E**.</span>

<span class="sd">        :param y: Spatially discretised 1D function of **E** (i.e. a **np.ndarray** of dtype **np.float32**) of length **self.num_x**</span>
<span class="sd">        :param t: Time-point at which to evaluate (**np.float32**)</span>
<span class="sd">        :return: Time differential of **E** at each spatial block (**np.ndarray** of dtype **np.float32** and length **self.num_x**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">PIP2_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PIP2_tot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">dE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_E</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_1d</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_on</span> <span class="o">*</span> <span class="n">PIP2_free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_crit</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_off</span> <span class="o">*</span> <span class="n">E</span>
        <span class="k">return</span> <span class="n">dE</span></div>

<div class="viewcode-block" id="simulation.f_apical_on"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.f_apical_on">[docs]</a>    <span class="k">def</span> <span class="nf">f_apical_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        System of partial differential equations as defined in the Supplementary Modelling, describing the spatio-temporal</span>
<span class="sd">        evolution of **E** **modelling cell-cell contacts, where E can load only on the apical membrane**.</span>

<span class="sd">        :param y: Spatially discretised 1D function of **E** (i.e. a **np.ndarray** of dtype **np.float32**) of length **self.num_x**</span>
<span class="sd">        :param t: Time-point at which to evaluate (**np.float32**)</span>
<span class="sd">        :return: Time differential of **E** at each spatial block (**np.ndarray** of dtype **np.float32** and length **self.num_x**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">PIP2_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PIP2_tot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">dE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_E</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_1d</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">apical_mask</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k_on</span> <span class="o">*</span> <span class="n">PIP2_free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_crit</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_off</span> <span class="o">*</span> <span class="n">E</span>
        <span class="k">return</span> <span class="n">dE</span></div>

<div class="viewcode-block" id="simulation.solve"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">apical_on</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the simulation. Uses the **scipy.integrate.odeint** package to integrate the defined system of PDEs.</span>

<span class="sd">        If **apical_on** is **True**, then simulate with cell-cell contacts (where loading is restricted to the apical membrane)</span>

<span class="sd">        If **apical_on** is **False**, then simulate without cell-cell contacts.</span>

<span class="sd">        :param apical_on: Specifies whether to simulate with or without cell-cell contacts (**np.bool**)</span>
<span class="sd">        :return: **self.y_sol**, a 2D **np.ndarray** array (**n_t** x **self.num_x**), where **n_t** is the number of time-steps (as defined by **self.t_span**).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apical_on</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_span</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_apical_on</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysolorig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span></div>

<div class="viewcode-block" id="simulation.centre_solution"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.centre_solution">[docs]</a>    <span class="k">def</span> <span class="nf">centre_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the simulation is performed on Periodic Boundary Conditions, the central location is undefined. For clarity,</span>
<span class="sd">        this function centres the solution such that the maximal **E** at the final time-step lies at **self.num_x/2**.</span>

<span class="sd">        Over-writes **self.y_sol** and also saves in **self.ysolshift** as a copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x_shift</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">x_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysolshift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">,</span> <span class="n">x_shift</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysolshift</span></div>

<div class="viewcode-block" id="simulation.get_apical_solution"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.get_apical_solution">[docs]</a>    <span class="k">def</span> <span class="nf">get_apical_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crop the solution down to just the apical membrane (as defined by **self.l_apical** versus **self.L**).</span>

<span class="sd">        The solution is first centred before cropping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centre_solution</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysol_apical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysolshift</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span></div>

<div class="viewcode-block" id="simulation.norm"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.norm">[docs]</a>    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generic function to normalize a 1D **np.ndarray**, calculating the normalized array **y** as:</span>

<span class="sd">        y = (x-min(x))/(max(x) - min(x))</span>

<span class="sd">        :param x: A 1D **np.ndarray** to be normalized.</span>
<span class="sd">        :return: Normalized **np.ndarray**, **y**.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span></div>

<div class="viewcode-block" id="simulation.plot_time_series"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.plot_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cmap</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">apical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot time-series of the simulation, as an overlayed set of lines.</span>

<span class="sd">        The number of time-points that are sampled is set by the parameter **cmap**, a (n_sample x 4) **np.ndarray** of</span>
<span class="sd">        RGBA colour points. **cmap** can be generated using plt.cm.Reds(np.linspace(0,1,n_sample)) for example.</span>

<span class="sd">        :param cmap: The colormap used to plot the solution (a **np.ndarray**)</span>
<span class="sd">        :param show: If **True**, then show the plot.</span>
<span class="sd">        :param filename: **str** defining the file-name of the plot if is being saved. If **False** then the plot is not saved.</span>
<span class="sd">        :param apical: Determines whether to plot the whole membrane (**False**) or just the apical membrane (**True**) (**np.bool**)</span>
<span class="sd">        :param ylim: Axis limits on the y-axis (i.e. the concentration of **E**) (**tuple**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centre_solution</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">apical</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_apical_solution</span><span class="p">()</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_span</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">apical</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_apical</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_apical</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol_apical</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$E$&quot;</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Time (%)&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/</span><span class="si">%s</span><span class="s2">.pdf&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></div>

<div class="viewcode-block" id="simulation.get_rel_height"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.get_rel_height">[docs]</a>    <span class="k">def</span> <span class="nf">get_rel_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find ∆E, the difference between the maximum and minimum value of **E** at the final time-step.</span>
<span class="sd">        :return: ∆E, **self.rel_height** (a **np.float32**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span></div>

<div class="viewcode-block" id="simulation.get_rel_heights"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.get_rel_heights">[docs]</a>    <span class="k">def</span> <span class="nf">get_rel_heights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find ∆E for all time-points</span>
<span class="sd">        :return: **self.rel_heights (**np.ndarray** of shape (**n_t** x 1) and dtype **np.float32**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_heights</span></div>

<div class="viewcode-block" id="simulation.get_amount"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.get_amount">[docs]</a>    <span class="k">def</span> <span class="nf">get_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find **self.amount** = int_0^L {E} dx</span>
<span class="sd">        :return: **self.amount**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span></div>

<div class="viewcode-block" id="simulation.find_peaks"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.find_peaks">[docs]</a>    <span class="k">def</span> <span class="nf">find_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count the number of peaks in a solution.</span>
<span class="sd">        :param y: **1D** array of concentrations (i.e. **E** at a given time t) (**np.ndarray** of size (**self.num_x x 1**) and dtype **np.float32**)</span>
<span class="sd">        :return: Number of peaks (**np.int32**)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ynorm</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">ysign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ynorm</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ysign</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">ysign</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pks</span></div>

<div class="viewcode-block" id="simulation.get_peaks"><a class="viewcode-back" href="../stub/oneD_simulation.simulation.html#oneD_simulation.simulation.get_peaks">[docs]</a>    <span class="k">def</span> <span class="nf">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the number of peaks for all time-points.</span>

<span class="sd">        Number of peaks = 0 when the relative height is too low (i.e. discounting spurious multi-peak solutions, where variations are miniscule).</span>
<span class="sd">        The threshold is set by **self.pol_thresh**.</span>

<span class="sd">        :return: Number of peaks **self.peaks** a **np.ndarray** of size (**n_t** x 1) and dtype **np.int32**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_rel_height</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol_thresh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ysol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span></div></div>


<div class="viewcode-block" id="phase_space"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space">[docs]</a><span class="k">class</span> <span class="nc">phase_space</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Phase space object performing a parameter span for a (custom) pair of parameters using regular equations</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="phase_space.__init__"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">set_num_x</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">apical_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">set_t_span</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalculate_initial</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xvar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yvar</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$log_10 \lambda$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$1 / \epsilon$&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">[],[],[]</span></div>

<div class="viewcode-block" id="phase_space.set_names"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.set_names">[docs]</a>    <span class="k">def</span> <span class="nf">set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Phase space considers solutions when varying two parameters. So this function sets the **axis-labels** of the</span>
<span class="sd">        x and y axes</span>
<span class="sd">        :param xname: **Axis label** of the x-axis (**str**), e.g. r&quot;$log_10 \lambda$&quot;</span>
<span class="sd">        :param yname: **Axis label** of the x-axis (**str**), e.g. r&quot;$1 / \epsilon$&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span> <span class="o">=</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yname</span></div>

<div class="viewcode-block" id="phase_space.get_initial"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.get_initial">[docs]</a>    <span class="k">def</span> <span class="nf">get_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate initial condition for the simulation.</span>

<span class="sd">        If the parameter **self.recalculate_initial** is **True**, then the initial condition is recalculated, as defined</span>
<span class="sd">        in the **simulation** class.</span>

<span class="sd">        If it&#39;s **False**, then the previous initial condition is utilized**</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recalculate_initial</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span></div>

<div class="viewcode-block" id="phase_space.get_outname"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.get_outname">[docs]</a>    <span class="k">def</span> <span class="nf">get_outname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the labels attributed to the various statistics that are calculated.</span>
<span class="sd">        :param out: The output matrix from the parameter sweep (e.g. **self.rel_height**)</span>
<span class="sd">        :return: Label (**str**) (e.g. r&quot;$\Delta E$&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;$\Delta E$&quot;</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;$\int_0^L  E \ dx$&quot;</span></div>

<div class="viewcode-block" id="phase_space.get_stats"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.get_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the simulation (with repeats as defined by the **np.int** **self.rep**), and calculate the summary statistics:</span>
<span class="sd">        the relative height (∆E), the amount (int E dx), and the number of peaks.</span>
<span class="sd">        :param X: Two-element list or array defining the values of the parameters attributed to the x or y axis</span>
<span class="sd">        :return: Three-element array of the statistics, as defined by the order listed above.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xvar</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yvar</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_initial</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">get_rel_height</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">get_amount</span><span class="p">())</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span></div>

<div class="viewcode-block" id="phase_space.perform_param_scan"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.perform_param_scan">[docs]</a>    <span class="k">def</span> <span class="nf">perform_param_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">yscale</span><span class="p">,</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span>  <span class="n">resolution</span><span class="p">,</span> <span class="n">xvar</span><span class="o">=</span><span class="s2">&quot;D_E&quot;</span><span class="p">,</span> <span class="n">yvar</span><span class="o">=</span><span class="s2">&quot;E_crit&quot;</span><span class="p">,</span>
                           <span class="n">recalculate_initial</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the parameter scan.</span>

<span class="sd">        Saves the parameter-scan to an **npy** file.</span>

<span class="sd">        Uses the **joblib** parallelisation package.</span>

<span class="sd">        :param xlim: Tuple, setting the minimum and maximum of the xvar to simulate over.</span>
<span class="sd">            If xlim = (a,b), (where a &lt; b)</span>
<span class="sd">            then if xscale is &quot;log&quot;, simulate between 10^a and 10^b</span>
<span class="sd">            if xscale is &quot;reciprocal&quot;, simulate between 1/b and 1/a</span>
<span class="sd">            if xscale is &quot;normal&quot;, then simulate between a and b</span>
<span class="sd">        :param ylim: Tuple, setting the minimum and maximum of the yvar to simulate over. Same rules as xvar</span>
<span class="sd">        :param xscale: Scale of the x-axis, setting the stepping of the parameter discretization. A **str**: either &quot;log&quot;, &quot;reciprocal&quot; or &quot;normal&quot;</span>
<span class="sd">        :param yscale: Scale of y-axis. Same rules as xscale.</span>
<span class="sd">        :param resolution: Number of parameter discretisations to simulate over. Can be an **np.int32**, where paramter</span>
<span class="sd">            discretisation number is same in x and y axis, or a **tuple** of **np.int32**, defining the number of</span>
<span class="sd">            spatial discretisations for the x vs y axis</span>
<span class="sd">        :param xvar: **str** defining the x-axis attributed parameter. Must match nomencalture of the code precisely. e.g. &quot;D_E&quot;</span>
<span class="sd">        :param yvar: **str** defining the y-axis attributed parameter. Must match nomencalture of the code precisely. e.g. &quot;E_crit&quot;</span>
<span class="sd">        :param recalculate_initial: Recalculate the initial condition of the simulation for each repeat and each</span>
<span class="sd">            parameter combination if **True**. Else the first initial condition is stored and re-used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xvar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yvar</span> <span class="o">=</span> <span class="n">xvar</span><span class="p">,</span> <span class="n">yvar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalculate_initial</span> <span class="o">=</span> <span class="n">recalculate_initial</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">resolutionx</span><span class="p">,</span> <span class="n">resolutiony</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resolutionx</span><span class="p">,</span><span class="n">resolutiony</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">resolution</span>
        <span class="k">if</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutionx</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutionx</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutionx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutiony</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutiony</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolutiony</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">num_cores</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stats</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;param_scan_</span><span class="si">%s</span><span class="s2">.npy&quot;</span> <span class="o">%</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">out</span><span class="p">)</span></div>

<div class="viewcode-block" id="phase_space.make_param_span_plot"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.make_param_span_plot">[docs]</a>    <span class="k">def</span> <span class="nf">make_param_span_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">percentile_lim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span><span class="n">overlay_peaks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the parameter scan.</span>

<span class="sd">        :param ax: **matplotlib** axis object to plot the parameter scan onto.</span>
<span class="sd">        :param out: **np.ndarray** of statistics for each parameter combination (**resolution x resolution**). E.g. **self.rel_height**</span>
<span class="sd">        :param xscale: Scale of the x-axis. Must be the same as in **self.perform_param_scan**.</span>
<span class="sd">        :param yscale: Scale of the y-axis. Must be the same as in **self.perform_param_scan**.</span>
<span class="sd">        :param percentile_lim: Cut-off for the colorbar, setting the maximum and minimum percentile of the statistic for which a color is attributed.</span>
<span class="sd">        :param cmap: **matplotlib.cm** object e.g. **matplotlib.cm.plasma**</span>
<span class="sd">        :param overlay_peaks: Overlay the number of peaks for each parameter combination (i.e. to identify multi-peak regimes).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_space</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">percentile_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">percentile_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                  <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                  <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlay_peaks</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overlay_peaks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">))</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.073</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_outname</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">,</span>
               <span class="n">aspect</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="phase_space.overlay_peaks"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.overlay_peaks">[docs]</a>    <span class="k">def</span> <span class="nf">overlay_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overlay the number of peaks. Transparent if 1 or 0 peaks, or increasingly black if multi-peak solutions are frequent.</span>
<span class="sd">        :param ax: **matplotlib** axis object</span>
<span class="sd">        :return: ax</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">mask</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="phase_space.plot_param_scan"><a class="viewcode-back" href="../stub/oneD_simulation.phase_space.html#oneD_simulation.phase_space.plot_param_scan">[docs]</a>    <span class="k">def</span> <span class="nf">plot_param_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">percentile_lim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">overlay_peaks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make full parameter scan plot. A wrapper for **self.make_param_span_plot**.</span>

<span class="sd">        Saves the plot to the **plots** directory as a PDF.</span>

<span class="sd">        :param out: **np.ndarray** of statistics for each parameter combination (**resolution x resolution**). E.g. **self.rel_height**</span>
<span class="sd">        :param xscale: Scale of the x-axis. Must be the same as in **self.perform_param_scan**.</span>
<span class="sd">        :param yscale: Scale of the y-axis. Must be the same as in **self.perform_param_scan**.</span>
<span class="sd">        :param percentile_lim: Cut-off for the colorbar, setting the maximum and minimum percentile of the statistic for which a color is attributed.</span>
<span class="sd">        :param cmap: **matplotlib.cm** object e.g. **matplotlib.cm.plasma**</span>
<span class="sd">        :param overlay_peaks: Overlay the number of peaks for each parameter combination (i.e. to identify multi-peak regimes).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_param_span_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">percentile_lim</span><span class="o">=</span><span class="n">percentile_lim</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">overlay_peaks</span><span class="o">=</span><span class="n">overlay_peaks</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plots/</span><span class="si">%s</span><span class="s2"> vs </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2">.pdf&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_outname</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="n">overlay_peaks</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Jake Cornwall-Scoones

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>